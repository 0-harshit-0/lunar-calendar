<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lunar Snapshot</title>
  <meta name="description" content="Friendly, accessible lunar snapshot for any date. See tithi, phase, zodiac signs, longitudes and coordinates. Download or copy JSON." />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small focus helper for consistent visible focus */
    .focus-ring:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.16);
      border-radius: .375rem;
    }
  </style>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Dataset",
      "name": "Lunar snapshot",
      "datePublished": "2026-01-27",
      "distribution": [
        {
          "@type": "DataDownload",
          "encodingFormat": "application/json",
          "contentUrl": "https://lunar-calendar-laeb.onrender.com/info"
        }
      ]
    }
  </script>

</head>
<body class="bg-slate-50 text-slate-800 antialiased">
  <header class="bg-white shadow-sm w-full mx-auto px-3 md:px-9 py-6 flex items-center justify-between">
      <div class="">
        <a href="/" class="inline-flex items-center gap-3 text-slate-900 no-underline" aria-label="Go to home">
          <span class="font-semibold text-lg">Lunar Calendar</span>
        </a>
        <p class="text-sm text-slate-500 mt-1">Pick any date to see the moon and sun at a glance</p>
      </div>

      <form id="dateForm" class="flex items-center gap-3" aria-label="Choose date">
        <label for="dateInput" class="sr-only">Date</label>
        <input id="dateInput" name="date" type="date" class="focus-ring px-3 py-2 border rounded-md shadow-sm bg-white" aria-describedby="dateHelp" />
        <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md shadow-sm hover:bg-indigo-700 focus-ring" id="fetchBtn">
          Show
        </button>
      </form>
  </header>

  <main class="mx-auto px-3 md:px-9 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main panel -->
      <section id="mainPanel" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm" role="region" aria-labelledby="mainTitle">
        <div class="flex items-start justify-between">
          <div>
            <h1 id="mainTitle" class="text-2xl font-semibold">Lunar snapshot</h1>
            <p class="text-sm text-slate-500 mt-1">Date: <time id="displayDate">2025-01-27</time></p>
          </div>

          <div class="flex items-center gap-2">
            <button id="downloadJson" class="text-sm px-3 py-2 border rounded-md bg-slate-50 hover:bg-slate-100 focus-ring" aria-label="Download JSON" disabled>
              Download JSON
            </button>
            <button id="copyJson" class="text-sm px-3 py-2 border rounded-md bg-slate-50 hover:bg-slate-100 focus-ring" aria-label="Copy JSON to clipboard" disabled>
              Copy JSON
            </button>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Friendly cultural info -->
          <article aria-labelledby="culturalTitle" class="flex flex-col p-4 border rounded-lg bg-gradient-to-b from-white to-slate-50">
            <h2 id="culturalTitle" class="text-lg font-medium">Everyday details</h2>
            <!-- <p class="text-sm text-slate-600 mt-1">Short, plain explanations so anyone can understand them</p> -->

            <dl class="my-4 space-y-3 text-sm">
              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Ayana</dt>
                <dd id="ayana" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Season name</dt>
                <dd id="ritu" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Lunar month</dt>
                <dd id="masa" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Half of month</dt>
                <dd id="paksha" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Tithi</dt>
                <dd id="tithi" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Moon phase</dt>
                <dd id="phase" class="font-medium">N/A</dd>
              </div>
            </dl>

            <details class="mt-auto text-sm text-slate-600">
              <summary class="cursor-pointer">What do these mean?</summary>
              <ul class="mt-2 list-disc pl-5">
                <li>Ayana and season name give a broad seasonal context.</li>
                <li>Lunar month and tithi are used in many calendars to mark days.</li>
                <li>Moon phase tells if the moon is growing or shrinking.</li>
              </ul>
            </details>
          </article>

          <!-- Astronomical basics -->
          <article aria-labelledby="astroTitle" class="flex flex-col p-4 border rounded-lg bg-gradient-to-b from-white to-slate-50">
            <h2 id="astroTitle" class="text-lg font-medium">Sky basics</h2>
            <!-- <p class="text-sm text-slate-600 mt-1">Simple labels plus the precise numbers if you want them</p> -->

            <dl class="my-4 space-y-3 text-sm">
              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Sun sign</dt>
                <dd id="sunRashi" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Moon sign</dt>
                <dd id="moonRashi" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Sun longitude</dt>
                <dd id="sunLon" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Moon longitude</dt>
                <dd id="moonLon" class="font-medium">N/A</dd>
              </div>

              <div class="flex items-start justify-between">
                <dt class="text-slate-600">Angle between Sun and Moon</dt>
                <dd id="longAngle" class="font-medium">N/A</dd>
              </div>
            </dl>

            <details class="mt-auto text-sm text-slate-600">
              <summary class="cursor-pointer">Why these numbers matter</summary>
              <p class="mt-2">Longitudes and the angle help describe the moon phase and relative positions in the sky. You can use the precise values if you are tracking navigation or astronomy data.</p>
            </details>
          </article>
        </div>

        <!-- Coordinates -->
        <section class="mt-6 p-4 border rounded-lg bg-white" aria-labelledby="coordsTitle">
          <h3 id="coordsTitle" class="text-md font-medium">Positions in space (KM)</h3>
          <p class="text-sm text-slate-500 mt-1">X, Y, Z values as provided by the source</p>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <figure class="bg-slate-50 p-4 rounded-lg">
              <figcaption class="flex items-center justify-between">
                <span class="text-sm font-medium">Sun position</span>
                <button class="copy-coords text-xs px-2 py-1 border rounded focus-ring" data-target="sun">Copy</button>
              </figcaption>
              <pre id="sunXYZ" class="mt-3 text-xs overflow-x-auto font-mono bg-white p-3 rounded text-slate-700">N/A</pre>
            </figure>

            <figure class="bg-slate-50 p-4 rounded-lg">
              <figcaption class="flex items-center justify-between">
                <span class="text-sm font-medium">Moon position</span>
                <button class="copy-coords text-xs px-2 py-1 border rounded focus-ring" data-target="moon">Copy</button>
              </figcaption>
              <pre id="moonXYZ" class="mt-3 text-xs overflow-x-auto font-mono bg-white p-3 rounded text-slate-700">N/A</pre>
            </figure>
          </div>
        </section>

        <div class="mt-4">
          <p id="status" class="text-sm text-slate-500" aria-live="polite">Ready</p>
        </div>
      </section>

      <!-- Right column: simple controls and notes -->
      <aside class="space-y-6">
        <div class="bg-white p-4 rounded-lg shadow-sm" role="note" aria-labelledby="aboutTitle">
          <h4 id="aboutTitle" class="text-sm font-semibold">Notes</h4>
          <p class="mt-2 text-sm text-slate-600">
            Data comes from a public lunar API. This page works best with JavaScript enabled.
            If you are not sure what a value means, tap the “What do these mean” links for friendly explanations.
          </p>

          <div class="mt-4">
            <h5 class="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2">
              Sky diagram (top view)
            </h5>
            <canvas
              id="skyCanvas"
              class="w-full border rounded bg-slate-50"
              aria-label="Sun Earth Moon diagram"
              role="img"
            ></canvas>
            <p class="mt-2 text-xs text-slate-500">
              Angles are measured from the Aries point (0°), centered on Earth.
            </p>
          </div>

          <!-- GitHub info -->
          <div class="mt-4 border-t pt-3">
            <h5 class="text-xs font-semibold text-slate-500 uppercase tracking-wide">
              Open source
            </h5>
            <p class="mt-2 text-sm text-slate-600">
              Source code and API implementation are available on GitHub.
            </p>
            <a
              href="https://github.com/0-harshit-0/lunar-calendar/"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 mt-2 text-sm font-medium text-indigo-600 hover:text-indigo-700 focus-ring"
              aria-label="View lunar calendar project on GitHub"
            >
              <svg aria-hidden="true" viewBox="0 0 24 24" class="w-4 h-4 fill-current">
                <path d="M12 .5C5.65.5.5 5.78.5 12.29c0 5.2 3.44 9.6 8.21 11.16.6.12.82-.27.82-.6 0-.3-.01-1.1-.02-2.16-3.34.75-4.04-1.66-4.04-1.66-.55-1.42-1.34-1.8-1.34-1.8-1.1-.78.08-.77.08-.77 1.21.09 1.85 1.27 1.85 1.27 1.08 1.9 2.83 1.35 3.52 1.03.11-.8.42-1.35.76-1.66-2.66-.31-5.46-1.36-5.46-6.05 0-1.34.47-2.43 1.24-3.29-.12-.31-.54-1.57.12-3.28 0 0 1.01-.33 3.3 1.26a11.2 11.2 0 0 1 3-.42c1.02 0 2.05.14 3 .42 2.28-1.59 3.29-1.26 3.29-1.26.66 1.71.24 2.97.12 3.28.77.86 1.23 1.95 1.23 3.29 0 4.7-2.81 5.74-5.49 6.04.43.38.81 1.12.81 2.26 0 1.63-.02 2.95-.02 3.35 0 .33.21.73.83.6 4.77-1.56 8.2-5.96 8.2-11.16C23.5 5.78 18.35.5 12 .5z"/>
              </svg>
              View on GitHub
            </a>
          </div>
        </div>
      </aside>

    </div>

    <noscript class="mt-6 block text-sm text-red-600">JavaScript is required to fetch live data</noscript>
  </main>

<!--   <footer class="max-w-6xl mx-auto px-4 py-6 text-sm text-slate-500">
    <p>Source: https://github.com/0-harshit-0/lunar-calendar/</p>
  </footer> -->

  <script>
    // API endpoint
    const API_BASE = 'https://lunar-calendar-laeb.onrender.com/info';

    // Elements
    const dateInput = document.getElementById('dateInput');
    const dateForm = document.getElementById('dateForm');
    const displayDate = document.getElementById('displayDate');
    const statusEl = document.getElementById('status');
    const fetchBtn = document.getElementById('fetchBtn');
    const downloadJsonBtn = document.getElementById('downloadJson');
    const copyJsonBtn = document.getElementById('copyJson');

    const ayanaEl = document.getElementById('ayana');
    const rituEl = document.getElementById('ritu');
    const masaEl = document.getElementById('masa');
    const pakshaEl = document.getElementById('paksha');
    const tithiEl = document.getElementById('tithi');
    const phaseEl = document.getElementById('phase');
    const sunRashiEl = document.getElementById('sunRashi');
    const moonRashiEl = document.getElementById('moonRashi');
    const sunLonEl = document.getElementById('sunLon');
    const moonLonEl = document.getElementById('moonLon');
    const longAngleEl = document.getElementById('longAngle');
    const sunXYZPre = document.getElementById('sunXYZ');
    const moonXYZPre = document.getElementById('moonXYZ');


    function formatNumber(n, digits = 6) {
      if (typeof n !== 'number' || !isFinite(n)) return 'N/A';
      return Number(n).toFixed(digits);
    }

    function setStatus(msg, isError = false) {
      statusEl.textContent = msg;
      statusEl.classList.toggle('text-red-600', isError);
      statusEl.classList.toggle('text-slate-500', !isError);
    }

    async function fetchForDate(isoDate) {
      setStatus('Loading data...');
      fetchBtn.disabled = true;
      try {
        const url = new URL(API_BASE);
        url.searchParams.set('date', isoDate);
        const res = await fetch(url.toString(), {cache: 'no-store'});
        if (!res.ok) throw new Error('Network error ' + res.status);
        const data = await res.json();
        renderData(data);
        setStatus('Data loaded');
        enableJsonActions(data);
      } catch (err) {
        console.error(err);
        setStatus('Could not fetch data: ' + err.message, true);
        clearDisplay();
        disableJsonActions();
      } finally {
        fetchBtn.disabled = false;
      }
    }

    function renderData(data) {
      const iso = data.date || dateInput.value || exampleDate;
      displayDate.textContent = iso;

      // plain text fields
      ayanaEl.textContent = data.ayana ?? 'N/A';
      rituEl.textContent = data.ritu ?? 'N/A';
      masaEl.textContent = data.masa ?? 'N/A';
      pakshaEl.textContent = data.paksha ?? 'N/A';
      tithiEl.textContent = data.tithi ?? 'N/A';
      phaseEl.textContent = data.phase ?? 'N/A';

      sunRashiEl.textContent = data.surya_rashi ?? 'N/A';
      moonRashiEl.textContent = data.chandra_rashi ?? 'N/A';
      sunLonEl.textContent = (typeof data.surya_longitude_deg === 'number') ? formatNumber(data.surya_longitude_deg, 6) + '°' : 'N/A';
      moonLonEl.textContent = (typeof data.chandra_longitude_deg === 'number') ? formatNumber(data.chandra_longitude_deg, 6) + '°' : 'N/A';
      longAngleEl.textContent = (typeof data.longitudinal_angle_deg === 'number') ? formatNumber(data.longitudinal_angle_deg, 6) + '°' : 'N/A';

      sunXYZPre.textContent = Array.isArray(data.surya_xyz) ? '[' + data.surya_xyz.map(n => formatNumber(n, 3)).join(', ') + ']' : 'N/A';
      moonXYZPre.textContent = Array.isArray(data.chandra_xyz) ? '[' + data.chandra_xyz.map(n => formatNumber(n, 3)).join(', ') + ']' : 'N/A';

      updateJsonLdTag(data);
    }

    function updateJsonLdTag(data) {
      let existing = document.querySelector('script[type="application/ld+json"][data-generated="lunar-info"]');
      const payload = {
        "@context": "https://schema.org",
        "@type": "Observation",
        "name": "Lunar snapshot for " + (data.date || ''),
        "observationDate": data.date || '',
        "additionalProperty": [
          { "name": "ayana", "value": data.ayana },
          { "name": "ritu", "value": data.ritu },
          { "name": "masa", "value": data.masa },
          { "name": "paksha", "value": data.paksha },
          { "name": "tithi", "value": data.tithi }
        ]
      };
      if (existing) existing.textContent = JSON.stringify(payload);
      else {
        const s = document.createElement('script');
        s.type = 'application/ld+json';
        s.setAttribute('data-generated', 'lunar-info');
        s.textContent = JSON.stringify(payload);
        document.head.appendChild(s);
      }
    }

    function clearDisplay() {
      displayDate.textContent = exampleDate;
      const els = [ayanaEl, rituEl, masaEl, pakshaEl, tithiEl, phaseEl, sunRashiEl, moonRashiEl, sunLonEl, moonLonEl, longAngleEl];
      els.forEach(e => e.textContent = 'N/A');
      sunXYZPre.textContent = moonXYZPre.textContent = 'N/A';
    }

    function enableJsonActions(data) {
      downloadJsonBtn.disabled = false;
      copyJsonBtn.disabled = false;

      downloadJsonBtn.onclick = () => {
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `lunar-${data.date || 'data'}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      };

      copyJsonBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
          setStatus('JSON copied to clipboard');
        } catch (err) {
          setStatus('Could not copy JSON: ' + err.message, true);
        }
      };
    }

    function disableJsonActions() {
      downloadJsonBtn.disabled = true;
      copyJsonBtn.disabled = true;
      downloadJsonBtn.onclick = null;
      copyJsonBtn.onclick = null;
    }

    function canvasDraw() {
        const dpr = window.devicePixelRatio || 1;
  
      // Example values (replace with API values)
      const sunLongitudeDeg = 308.717858;
      const moonLongitudeDeg = 75.948367;

      const canvas = document.getElementById('skyCanvas');
      const ctx = canvas.getContext('2d');
  const rect = canvas.getBoundingClientRect();

        canvas.width = Math.round(rect.width * dpr);
  canvas.height = Math.round(rect.height * dpr);

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      // Visual scale (purely illustrative)
      const sunRadius = 90;
      const moonRadius = 65;

      // Convert degrees to canvas angle
      // Canvas: 0 rad = right, positive clockwise
      // Astronomy: 0° = Aries direction, counter-clockwise
      function toCanvasAngle(deg) {
        return (deg - 90) * Math.PI / 180;
      }

      function polarToXY(radius, angle) {
        return {
          x: cx + radius * Math.cos(angle),
          y: cy + radius * Math.sin(angle)
        };
      }

      // Clear
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw reference circle (ecliptic)
      ctx.beginPath();
      ctx.arc(cx, cy, sunRadius, 0, Math.PI * 2);
      ctx.strokeStyle = '#e5e7eb';
      ctx.stroke();

      // Earth
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, Math.PI * 2);
      ctx.fillStyle = '#22c55e';
      ctx.fill();

      // Sun
      const sunAngle = toCanvasAngle(sunLongitudeDeg);
      const sunPos = polarToXY(sunRadius, sunAngle);

      ctx.beginPath();
      ctx.arc(sunPos.x, sunPos.y, 10, 0, Math.PI * 2);
      ctx.fillStyle = '#facc15';
      ctx.fill();

      // Moon
      const moonAngle = toCanvasAngle(moonLongitudeDeg);
      const moonPos = polarToXY(moonRadius, moonAngle);

      ctx.beginPath();
      ctx.arc(moonPos.x, moonPos.y, 6, 0, Math.PI * 2);
      ctx.fillStyle = '#9ca3af';
      ctx.fill();

      // Lines from Earth
      ctx.strokeStyle = '#111827';
      ctx.lineWidth = 1;

      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(sunPos.x, sunPos.y);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(moonPos.x, moonPos.y);
      ctx.stroke();

      // Aries direction marker (0°)
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(cx + sunRadius, cy);
      ctx.setLineDash([4, 4]);
      ctx.strokeStyle = '#94a3b8';
      ctx.stroke();
      ctx.setLineDash([]);
    }

    // copy coordinates buttons
    document.querySelectorAll('.copy-coords').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const target = e.currentTarget.dataset.target;
        let text = '';
        if (target === 'sun') text = sunXYZPre.textContent;
        if (target === 'moon') text = moonXYZPre.textContent;
        try {
          await navigator.clipboard.writeText(text);
          setStatus('Coordinates copied');
        } catch (err) {
          setStatus('Could not copy coordinates: ' + err.message, true);
        }
      });
    });

    // form submit handler
    dateForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const iso = dateInput.value;
      if (!iso) {
        setStatus('Please choose a date', true);
        return;
      }
      fetchForDate(iso);
    });

    // initial load
    (function init() {
      dateInput.setAttribute('aria-label', 'Select date for lunar snapshot');
      const today = new Date().toISOString().slice(0, 10);
      dateInput.value = today;
      displayDate.textContent = today;
      fetchForDate(today);
      canvasDraw()
    })();
  </script>
</body>
</html>
